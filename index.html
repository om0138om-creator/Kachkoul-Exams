<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #2c3e50;
            --light: #f8f9fa;
            --gray: #6c757d;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            padding: 15px;
            direction: rtl;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
            text-align: center;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hidden { display: none !important; }

        /* Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
        h1 {
            color: var(--dark);
            font-size: 24px;
            margin-bottom: 10px;
        }

        h2 {
            color: var(--dark);
            font-size: 20px;
            margin-bottom: 15px;
        }

        .subtitle {
            color: var(--gray);
            font-size: 14px;
            margin-bottom: 20px;
        }

        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙƒØ¨ÙŠØ±Ø© */
        .big-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± */
        .exam-info {
            background: var(--light);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: right;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .info-row:last-child { border-bottom: none; }

        .info-label {
            color: var(--gray);
            font-size: 15px;
        }

        .info-value {
            color: var(--dark);
            font-weight: bold;
            font-size: 15px;
        }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn {
            display: inline-block;
            padding: 15px 35px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            margin: 8px;
        }

        .btn:active { transform: scale(0.95); }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ÙˆÙ‚Øª */
        .timer-container {
            background: white;
            border-radius: 15px;
            padding: 15px 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .timer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .timer-display {
            font-size: 22px;
            font-weight: bold;
            color: var(--dark);
        }

        .timer-display.danger {
            color: var(--danger);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .question-counter {
            font-size: 14px;
            color: var(--gray);
            background: var(--light);
            padding: 5px 15px;
            border-radius: 20px;
        }

        .progress-track {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.4s ease;
        }

        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ */
        .question-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .question-number {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 8px 25px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 17px;
            color: var(--dark);
            line-height: 1.9;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            border-right: 5px solid var(--primary);
            margin-bottom: 25px;
            text-align: right;
            white-space: pre-wrap;
        }

        /* Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px 20px;
            background: var(--light);
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            border-color: var(--primary);
            background: #f0f3ff;
        }

        .option.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));
        }

        .option.correct {
            border-color: var(--success);
            background: rgba(39, 174, 96, 0.15);
        }

        .option.wrong {
            border-color: var(--danger);
            background: rgba(231, 76, 60, 0.15);
        }

        .option.locked { pointer-events: none; }

        .option-marker {
            width: 28px;
            height: 28px;
            border: 2px solid #ccc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: #ccc;
            flex-shrink: 0;
            transition: all 0.3s;
        }

        .option.selected .option-marker {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .option.correct .option-marker {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .option.wrong .option-marker {
            background: var(--danger);
            border-color: var(--danger);
            color: white;
        }

        .option-text {
            flex: 1;
            font-size: 15px;
            color: var(--dark);
            text-align: right;
            line-height: 1.6;
        }

        /* Ø²Ø± Ø§Ù„ØªØ³Ù„ÙŠÙ… */
        .submit-container {
            margin-top: 25px;
        }

        .submit-btn {
            width: 100%;
            padding: 16px;
            font-size: 17px;
            font-weight: 600;
            border: none;
            border-radius: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .submit-btn:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© */
        .result-icon {
            font-size: 90px;
            margin-bottom: 15px;
        }

        .result-score {
            font-size: 60px;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 15px 0;
        }

        .result-stats {
            background: var(--light);
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .stat-row:last-child { border-bottom: none; }

        .stat-label { color: var(--gray); }

        .stat-value {
            font-weight: bold;
            color: var(--dark);
        }

        .stat-value.success { color: var(--success); }
        .stat-value.danger { color: var(--danger); }

        /* Ø±Ø³Ø§Ù„Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© */
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 25px 45px;
            border-radius: 20px;
            font-size: 22px;
            font-weight: bold;
            z-index: 9999;
            animation: toastIn 0.4s ease;
        }

        .toast.success { background: #d4edda; color: var(--success); }
        .toast.error { background: #f8d7da; color: var(--danger); }

        @keyframes toastIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        /* ØªÙ†Ø¨ÙŠÙ‡ */
        .alert {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            text-align: right;
            font-size: 14px;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 50px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e0e0e0;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            color: var(--gray);
            font-size: 16px;
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ„ */
        .explanation-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(4px);
            animation: fadeIn 0.3s;
        }
        
        .explanation-content {
            background: white;
            width: 90%;
            max-width: 400px;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.3s;
        }

        .explanation-title {
            color: var(--danger);
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .explanation-text {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            color: var(--dark);
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 16px;
            border: 1px solid #eee;
        }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div class="container">
        
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
        <div class="card" id="loadingScreen">
            <div class="loading">
                <div class="spinner"></div>
                <div class="loading-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            </div>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø®ØªØ¨Ø§Ø± -->
        <div class="card hidden" id="noExamScreen">
            <div class="big-icon">ğŸ“š</div>
            <h1>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø®ØªØ¨Ø§Ø± Ø­Ø§Ù„ÙŠØ§Ù‹</h1>
            <p class="subtitle">Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø®ØµØµ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙÙ‚Ø·</p>
            <div class="alert">
                â³ Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© ÙˆØ³ÙŠØªÙ… Ø¥Ø¹Ù„Ø§Ù…Ùƒ Ø¹Ù†Ø¯ ØªÙˆÙØ±Ù‡Ø§!
            </div>
            <button class="btn btn-primary" onclick="closeApp()">
                ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨ÙˆØª
            </button>
        </div>

        <!-- Ø´Ø§Ø´Ø© ØªÙ… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø³Ø¨Ù‚Ø§Ù‹ -->
        <div class="card hidden" id="alreadyTakenScreen">
            <div class="big-icon">ğŸ”’</div>
            <h1>ØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h1>
            <p class="subtitle">Ù„Ù‚Ø¯ Ø£Ø¬Ø±ÙŠØª Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø³Ø¨Ù‚Ø§Ù‹</p>
            <div class="exam-info">
                <div class="info-row">
                    <span class="info-label">Ù†ØªÙŠØ¬ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</span>
                    <span class="info-value" id="prevScore">-</span>
                </div>
            </div>
            <div class="alert alert-danger">
                âš ï¸ Ù„Ø§ ÙŠÙØ³Ù…Ø­ Ø¨Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ø±Ø©!
            </div>
            <button class="btn btn-primary" onclick="closeApp()">
                ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨ÙˆØª
            </button>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
        <div class="card hidden" id="startScreen">
            <div class="big-icon">ğŸ“</div>
            <h1 id="examTitle">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h1>
            <p class="subtitle">Ø§Ø®ØªØ¨Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø§Ù„Ø¢Ù†!</p>
            
            <div class="exam-info">
                <div class="info-row">
                    <span class="info-label">â“ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</span>
                    <span class="info-value" id="totalQuestions">0</span>
                </div>
                <div class="info-row">
                    <span class="info-label">â±ï¸ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</span>
                    <span class="info-value" id="examDuration">ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©</span>
                </div>
                <div class="info-row">
                    <span class="info-label">ğŸ“Š Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</span>
                    <span class="info-value">Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·</span>
                </div>
            </div>

            <div class="alert">
                âš ï¸ <strong>ØªÙ†Ø¨ÙŠÙ‡:</strong> Ø¨Ù…Ø¬Ø±Ø¯ Ø§Ù„Ø¨Ø¯Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±!
            </div>

            <button class="btn btn-success btn-block" onclick="startExam()">
                âœ… Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¢Ù†
            </button>
            <button class="btn btn-outline" onclick="closeApp()">
                âŒ Ù„ÙŠØ³ Ø§Ù„Ø¢Ù†
            </button>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
        <div id="examScreen" class="hidden">
            <div class="timer-container">
                <div class="timer-header">
                    <span class="timer-display" id="timerDisplay">â±ï¸ 00:00</span>
                    <span class="question-counter" id="questionCounter">1 / 10</span>
                </div>
                <div class="progress-track">
                    <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="question-card">
                <div class="question-number" id="questionBadge">Ø§Ù„Ø³Ø¤Ø§Ù„ 1</div>
                <div class="question-text" id="questionText">Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§...</div>
                
                <div class="options-container" id="optionsContainer"></div>

                <div class="submit-container">
                    <button class="submit-btn" id="submitBtn" onclick="submitAnswer()" disabled>
                        ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© â¡ï¸
                    </button>
                </div>
            </div>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
        <div class="card hidden" id="resultScreen">
            <div class="result-icon" id="resultIcon">ğŸ†</div>
            <h2 id="resultTitle">Ø£Ø­Ø³Ù†Øª!</h2>
            <div class="result-score" id="resultScore">85%</div>
            
            <div class="result-stats">
                <div class="stat-row">
                    <span class="stat-label">ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</span>
                    <span class="stat-value" id="statTotal">10</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">âœ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©</span>
                    <span class="stat-value success" id="statCorrect">8</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">âŒ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©</span>
                    <span class="stat-value danger" id="statWrong">2</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚</span>
                    <span class="stat-value" id="statTime">05:30</span>
                </div>
            </div>

            <p style="color: var(--success); margin-bottom: 20px;">
                âœ… ØªÙ… Ø­ÙØ¸ Ù†ØªÙŠØ¬ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!
            </p>

            <button class="btn btn-primary btn-block" onclick="closeApp()">
                ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨ÙˆØª
            </button>
        </div>

        <div id="explanationModal" class="explanation-modal hidden">
            <div class="explanation-content">
                <div class="explanation-title">âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©</div>
                <div id="explanationText" class="explanation-text"></div>
                <button class="btn btn-primary btn-block" onclick="closeExplanation()">
                    Ø§Ù„ØªØ§Ù„ÙŠ â¬…ï¸
                </button>
            </div>
        </div>
    </div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //                    Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        const BOT_TOKEN = "8320893492:AAEVPyOQ31BImkeTtt3z-WaSJ52INc05vgw";
        const CHANNEL_ID = "-1003308250289";
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //                    Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        let tg = null;
        let examData = null;
        let currentQuestion = 0;
        let selectedOption = null;
        let userAnswers = [];
        let timerInterval = null;
        let timeRemaining = 0;
        let startTime = null;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //                    Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        try {
            tg = window.Telegram.WebApp;
            tg.ready();
            tg.expand();
            tg.MainButton.hide();
        } catch(e) {
            console.log('Not running in Telegram');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //                    ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(loadExamData, 500);
        });

        function loadExamData() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const data = urlParams.get('data');
                
                if (!data) {
                    showScreen('noExamScreen');
                    return;
                }

                // 1. Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø±Ù…ÙˆØ² Ù„ÙÙƒ Base64
                const base64 = data.replace(/-/g, '+').replace(/_/g, '/');
                
                // 2. ØªØ­ÙˆÙŠÙ„ Base64 Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ© Ø¨Ø§ÙŠØªØ§Øª (Uint8Array)
                const binaryString = window.atob(base64);
                const bytes = new Uint8Array(binaryString.length);
                for (let i = 0; i < binaryString.length; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }

                // 3. ÙÙƒ Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© pako
                // Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ© ØªØ¹ÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¶ØºÙˆØ·Ø© Ø¥Ù„Ù‰ Ù†ØµÙ‡Ø§ Ø§Ù„Ø£ØµÙ„ÙŠ
                const jsonString = pako.inflate(bytes, { to: 'string' });
                
                // 4. ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ JSON
                const rawData = JSON.parse(jsonString);

                if (!rawData) {
                    showScreen('noExamScreen');
                    return;
                }

                // Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                examData = {
                    id: rawData.i || rawData.id,
                    user_id: rawData.u || rawData.user_id,
                    title: rawData.t || rawData.title,
                    duration: rawData.d || rawData.duration,
                    questions: []
                };

                const questionsList = rawData.q || rawData.questions || [];
                
                examData.questions = questionsList.map(item => {
                    return {
                        id: item.i || item.id,
                        text: item.k || item.text,
                        options: item.o || item.options,
                        correct: item.c || item.correct,
                        explanations: item.e || item.explanations
                    };
                });

                if (examData.questions.length === 0) {
                    showScreen('noExamScreen');
                    return;
                }

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
                const examKey = `exam_${examData.id}_${examData.user_id}`;
                const previousResult = localStorage.getItem(examKey);
                
                if (previousResult) {
                    const prevData = JSON.parse(previousResult);
                    document.getElementById('prevScore').textContent = prevData.score + '%';
                    showScreen('alreadyTakenScreen');
                    return;
                }

                // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                document.getElementById('examTitle').textContent = examData.title || 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±';
                document.getElementById('totalQuestions').textContent = examData.questions.length;
                document.getElementById('examDuration').textContent = 
                    examData.duration && examData.duration > 0 ? 
                    examData.duration + ' Ø¯Ù‚ÙŠÙ‚Ø©' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©';
                
                showScreen('startScreen');

            } catch(e) {
                console.error('Error loading exam:', e);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ' + e.message);
                showScreen('noExamScreen');
            }
        }


        function showScreen(screenId) {
            document.querySelectorAll('.card, #examScreen').forEach(el => {
                el.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //                    Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function startExam() {
            showScreen('examScreen');
            
            startTime = new Date();
            userAnswers = [];
            currentQuestion = 0;

            if (examData.duration && examData.duration > 0) {
                timeRemaining = examData.duration * 60;
                startTimer();
            } else {
                document.getElementById('timerDisplay').textContent = 'â±ï¸ --:--';
            }

            displayQuestion(0);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //                    Ø§Ù„Ù…Ø¤Ù‚Øª
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function startTimer() {
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    finishExam(true);
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const display = document.getElementById('timerDisplay');
            
            display.textContent = `â±ï¸ ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            if (timeRemaining <= 60) {
                display.classList.add('danger');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //                    Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function displayQuestion(index) {
            const question = examData.questions[index];
            currentQuestion = index;
            selectedOption = null;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
            document.getElementById('questionBadge').textContent = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${index + 1}`;
            document.getElementById('questionText').textContent = question.text;
            document.getElementById('questionCounter').textContent = 
                `${index + 1} / ${examData.questions.length}`;
            
            // Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            const progress = ((index + 1) / examData.questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            // Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';

            const markers = ['Ø£', 'Ø¨', 'Ø¬', 'Ø¯', 'Ù‡Ù€', 'Ùˆ'];
            
            question.options.forEach((option, i) => {
                const optionEl = document.createElement('div');
                optionEl.className = 'option';
                optionEl.onclick = () => selectOption(i + 1, optionEl);
                optionEl.innerHTML = `
                    <div class="option-marker">${markers[i] || (i + 1)}</div>
                    <div class="option-text">${option}</div>
                `;
                container.appendChild(optionEl);
            });

            // Ø²Ø± Ø§Ù„ØªØ³Ù„ÙŠÙ…
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = (index === examData.questions.length - 1) ? 
                'Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± âœ…' : 'Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸';
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //                    Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø§Ø¨Ø©
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function selectOption(optionNum, element) {
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            element.classList.add('selected');
            selectedOption = optionNum;
            document.getElementById('submitBtn').disabled = false;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //                    ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function submitAnswer() {
            if (selectedOption === null) return;

            const question = examData.questions[currentQuestion];
            const isCorrect = selectedOption === question.correct;

            // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
            userAnswers.push({
                questionId: question.id,
                selected: selectedOption,
                correct: question.correct,
                isCorrect: isCorrect
            });

            // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
            const options = document.querySelectorAll('.option');
            options.forEach((opt, i) => {
                opt.classList.add('locked');
                if (i + 1 === question.correct) {
                    opt.classList.add('correct');
                } else if (i + 1 === selectedOption && !isCorrect) {
                    opt.classList.add('wrong');
                }
            });

            document.getElementById('submitBtn').disabled = true;

            // Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØªØ¹Ù„ÙŠÙ„
            if (!isCorrect && question.explanations && question.explanations[selectedOption]) {
                setTimeout(() => {
                    document.getElementById('explanationText').textContent = question.explanations[selectedOption];
                    document.getElementById('explanationModal').classList.remove('hidden');
                }, 600);
            } else {
                // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
                showToast(isCorrect ? 'âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!' : 'âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©!', isCorrect);
                setTimeout(() => {
                    goToNextQuestion();
                }, 1500);
            }
        }

        function closeExplanation() {
            document.getElementById('explanationModal').classList.add('hidden');
            goToNextQuestion();
        }

        function goToNextQuestion() {
            if (currentQuestion < examData.questions.length - 1) {
                displayQuestion(currentQuestion + 1);
            } else {
                finishExam(false);
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //                    Ø±Ø³Ø§Ù„Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function showToast(message, success) {
            const toast = document.createElement('div');
            toast.className = `toast ${success ? 'success' : 'error'}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.remove(), 1200);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //                    Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        // Ù…ØªØºÙŠØ± Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù„Ù„Ø¨ÙˆØª
        let finalResultToBot = null;

        function finishExam(timeout) {
            if (timerInterval) clearInterval(timerInterval);

            // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ø¯Ø±Ø¬Ø§Øª
            const endTime = new Date();
            const timeTakenSeconds = Math.floor((endTime - startTime) / 1000);
            
            const totalQuestions = examData.questions.length;
            const correctCount = userAnswers.filter(a => a.isCorrect).length;
            const wrongCount = totalQuestions - correctCount;
            const scorePercent = Math.round((correctCount / totalQuestions) * 100);

            // 1. ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©
            let icon, title;
            if (scorePercent >= 90) { icon = 'ğŸ†'; title = 'Ù…Ù…ØªØ§Ø²!'; }
            else if (scorePercent >= 75) { icon = 'ğŸŒŸ'; title = 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹!'; }
            else if (scorePercent >= 50) { icon = 'âœ…'; title = 'Ù†Ø§Ø¬Ø­'; }
            else { icon = 'ğŸ“š'; title = 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰'; }

            // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
            document.getElementById('resultIcon').textContent = icon;
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('resultScore').textContent = scorePercent + '%';
            document.getElementById('statTotal').textContent = totalQuestions;
            document.getElementById('statCorrect').textContent = correctCount;
            document.getElementById('statWrong').textContent = wrongCount;
            
            const mins = Math.floor(timeTakenSeconds / 60);
            const secs = timeTakenSeconds % 60;
            document.getElementById('statTime').textContent = 
                `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;

            // 3. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù„Ù‚Ù†Ø§Ø© ÙÙˆØ±Ø§Ù‹ (Ù„Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª)
            sendResultToChannel({
                exam_id: examData.id,
                exam_title: examData.title,
                user_id: examData.user_id,
                score: scorePercent,
                correct: correctCount,
                wrong: wrongCount,
                total: totalQuestions,
                time_taken: timeTakenSeconds,
                timeout: timeout,
                answers: userAnswers
            });

            // 4. ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù…ØªØºÙŠØ± (ÙÙŠ Ø­Ø§Ù„ Ù‚Ø±Ø± Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨ÙˆØª Ù„Ø§Ø­Ù‚Ø§Ù‹)
            finalResultToBot = {
                exam_id: examData.id,
                user_id: examData.user_id,
                score: scorePercent,
                correct: correctCount,
                wrong: wrongCount,
                total: totalQuestions,
                time_taken: timeTakenSeconds,
                answers: userAnswers
            };

            // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ Ù„Ù…Ù†Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
            const examKey = `exam_${examData.id}_${examData.user_id}`;
            localStorage.setItem(examKey, JSON.stringify({
                score: scorePercent,
                correct: correctCount,
                wrong: wrongCount,
                time: timeTakenSeconds,
                date: new Date().toISOString()
            }));

            // 5. Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© (ÙˆØ§Ù„Ø¨Ù‚Ø§Ø¡ ÙÙŠÙ‡Ø§)
            showScreen('resultScreen');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //                    Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù‚Ù†Ø§Ø©
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function sendResultToChannel(result) {
            const mins = Math.floor(result.time_taken / 60);
            const secs = result.time_taken % 60;
            
            let statusIcon;
            if (result.score >= 90) statusIcon = 'ğŸ†';
            else if (result.score >= 75) statusIcon = 'ğŸŒŸ';
            else if (result.score >= 50) statusIcon = 'âœ…';
            else statusIcon = 'âŒ';

            // Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ù†Ø§
            const message = `
ğŸ“Š Ù†ØªÙŠØ¬Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯Ø©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${result.exam_title}
ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: <a href="tg://user?id=${result.user_id}">${result.user_id}</a>

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ˆ Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${result.score}% ${statusIcon}
âœ… ØµØ­ÙŠØ­: ${result.correct}
âŒ Ø®Ø·Ø£: ${result.wrong}
ğŸ“‹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${result.total}

â± Ø§Ù„ÙˆÙ‚Øª: ${mins}:${String(secs).padStart(2, '0')}
${result.timeout ? 'âš ï¸ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!' : ''}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#Ù†ØªÙŠØ¬Ø©_Ø§Ø®ØªØ¨Ø§Ø± #exam_${result.exam_id}
`;

            const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… fetch Ø¨Ø¯ÙˆÙ† Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø³Ø±Ø¹Ø© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
            fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: CHANNEL_ID,
                    text: message,
                    parse_mode: 'HTML'
                })
            }).catch(e => console.log('Channel send error', e));
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //                    Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //                    Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //                    Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù…Ø¹Ø¯Ù„Ø©)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function closeApp() {
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ù…ØªØ§Ø­
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù†ØªÙŠØ¬Ø©ØŒ Ø£Ø±Ø³Ù„Ù‡Ø§
                if (finalResultToBot) {
                    try {
                        // 1. ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù†Øµ
                        let dataString = JSON.stringify(finalResultToBot);
                        
                        // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¬Ù… (ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… ÙŠÙ‚Ø¨Ù„ 4096 Ø¨Ø§ÙŠØª ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰)
                        // Ù†Ø³ØªØ®Ø¯Ù… 4000 ÙƒØ­Ø¯ Ø¢Ù…Ù†
                        if (dataString.length > 4000) {
                            // Ø§Ù„Ø­Ø¬Ù… ÙƒØ¨ÙŠØ±! Ù†Ø­Ø°Ù ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª ÙˆÙ†Ø±Ø³Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙ‚Ø·
                            const smallData = {
                                ...finalResultToBot,
                                answers: [] // Ø¥ÙØ±Ø§Øº Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù…
                            };
                            dataString = JSON.stringify(smallData);
                            // ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                            // alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø© ÙÙ‚Ø· Ù†Ø¸Ø±Ø§Ù‹ Ù„Ø·ÙˆÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±");
                        }

                        // 3. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¨ÙˆØª
                        tg.sendData(dataString);
                        
                    } catch (e) {
                        console.error("Error sending data:", e);
                        // ÙÙŠ Ø­Ø§Ù„ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ø£ÙŠ Ø³Ø¨Ø¨ØŒ Ù†ØºÙ„Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙˆØ±Ø§Ù‹
                        tg.close();
                    }
                } else {
                    // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ø§Ø¯ÙŠ (ÙÙŠ Ø­Ø§Ù„ Ù„Ù… ÙŠØ¯Ø®Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø£Ùˆ Ø®Ø±Ø¬ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡)
                    tg.close();
                }
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø¯Ø§Ø®Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
                window.close();
                history.back();
            }
        }

    </script>
</body>
</html>